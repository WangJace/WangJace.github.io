---
layout: post
title:  "RxSwiftåŸºç¡€"
date:   2018-05-10 14:49:00.000000000 +09:00
tags: [iOS ç¬”è®°]
---
RxSwiftä¸­å¯è®¢é˜…åºåˆ—ä¼šç»™è®¢é˜…è€…å‘é€çš„äº‹ä»¶ç±»å‹æœ‰Nextã€Errorã€Completedï¼ŒNextä¸ºæ­£å¸¸çš„äº‹ä»¶ï¼Œå½“å‡ºç°é”™è¯¯æ—¶ä¼šå‘é€Errorï¼Œå½“å®Œæˆæ—¶ä¼šè‡ªåŠ¨å‘é€Completedã€‚
### â€¢ åˆ›å»ºå¯è®¢é˜…äº‹ä»¶æµçš„å‡ ç§æ–¹å¼
#### 1.nerver
ä¸å‘æ¾ä»»ä½•äº‹ä»¶çš„å¯è®¢é˜…äº‹ä»¶æµï¼Œä¸‹é¢è¿™æ®µä»£ç ä¸ä¼šæ‰“å°ä»»ä½•ä¸œè¥¿ï¼Œå› ä¸ºneverä¸ä¼šå‘é€ä»»ä½•æ—¶é—´ç»™è®¢é˜…è€…ï¼Œæ‰€ä»¥è®¢é˜…è€…çš„ä»£ç å—ä¸ä¼šè¢«æ‰§è¡Œï¼Œå³ä¸ä¼šæ‰“å° *This will never be printed* ã€‚
{% highlight Swift %}
let neverSequence = Observable<String>.never()
let neverSequenceSubscription = neverSequence
                                    .subscribe { _ in
                                        print("This will never be printed")
                                    }
neverSequenceSubscription.disposed(by: DisposeBag())
{% endhighlight %}
#### 2.empty
åªå‘é€ *completed* äº‹ä»¶çš„å¯è®¢é˜…äº‹ä»¶æµã€‚ä¸‹é¢è¿™æ®µä»£ç åªä¼šæ‰“å° *completed* ã€‚
{% highlight Swift %}
Observable<Int>.empty()
    .subscribe { event in
        print(event)
        /* 
         completed
         */
    }
    .disposed(by: DisposeBag())
{% endhighlight %}
#### 3.just
åªå‘é€ä¸€ä¸ªäº‹ä»¶çš„å¯è®¢é˜…äº‹ä»¶æµã€‚
{% highlight Swift %}
Observable.just("ğŸ”´")
    .subscribe { event in
    print(event)
    /* 
     next(ğŸ”´)
     completed
     */
    }
    .disposed(by: DisposeBag())
{% endhighlight %}
#### 4.of
å‘é€ä¸€å®šæ•°é‡äº‹ä»¶çš„å¯è®¢é˜…äº‹ä»¶æµ.
{% highlight Swift %}
Observable.of("ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹")
    .subscribe({ event in
        print(event)
        /*
         next(ğŸ¶)
         next(ğŸ±)
         next(ğŸ­)
         next(ğŸ¹)
         completed
         */
    })
    .disposed(by: DisposeBag())
{% endhighlight %}
#### 5.from
è·å–ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆArrayã€Dictionaryã€Setï¼‰ä¸­çš„å…ƒç´ å¹¶è½¬ä¸ºä¸€ä¸ªä¸ªçš„äº‹ä»¶å‘é€çš„å¯è®¢é˜…äº‹ä»¶æµã€‚
{% highlight Swift %}
Observable.from(["ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹"])
    .subscribe({
        print($0)     // è¯­æ³•ç³–: $0ä»£è¡¨çš„æ˜¯ä»£ç å—çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè‹¥æœ‰å¤šä¸ªå‚æ•°ï¼Œåˆ™ä½¿ç”¨$0ã€$1ã€$2ï¼Œä¾æ­¤ç±»æ¨ã€‚
        /*
         next(ğŸ¶)
         next(ğŸ±)
         next(ğŸ­)
         next(ğŸ¹)
         completed
        */
    })
    .disposed(by: DisposeBag())
{% endhighlight %}   
è‹¥é˜Ÿåˆ—å…ƒç´ ä»ä¸ºé˜Ÿåˆ—ï¼Œfromä¸ä¼šè¿›ä¸€æ­¥è§£æã€‚fromåªè¿›è¡Œä¸€å±‚è§£æã€‚
{% highlight Swift %}
Observable.from([["ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹"], ["ğŸ", "ğŸ", "ğŸŠ", "ğŸ‹"]])
    .subscribe({
        print($0)
        /*
         next(["ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹"])
         next(["ğŸ", "ğŸ", "ğŸŠ", "ğŸ‹"])
         completed
         */
    })
    .disposed(by: DisposeBag())
{% endhighlight %}
fromå’Œofçš„åŒºåˆ«ï¼šofæ˜¯å°†ä¼ å…¥çš„æ¯ä¸ªå…ƒç´ è½¬ä¸ºäº‹ä»¶å‘é€ï¼Œfromæ˜¯å°†ä¼ å…¥çš„é˜Ÿåˆ—å…ƒç´ å–å‡ºï¼Œä¸€ä¸€è½¬ä¸ºäº‹ä»¶å‘é€ã€‚
{% highlight Swift %}
// of
Observable.of(["ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹"], ["ğŸ", "ğŸ", "ğŸŠ", "ğŸ‹"])
    .subscribe({
        print($0)
        /*
         next(["ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹"])
         next(["ğŸ", "ğŸ", "ğŸŠ", "ğŸ‹"])
         completed
         */
    })
    .disposed(by: DisposeBag())
{% endhighlight %}
#### 6.create
åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å¯è®¢é˜…äº‹ä»¶æµã€‚
{% highlight Swift %}
let myJust = { (element: String) -> Observable<String> in
    return Observable.create { observer in
                observer.on(.next(element))
                observer.on(.completed)
                return Disposables.create()
            }
    }
myJust("ğŸ”´")
    .subscribe {
        print($0)
        /*
         next(ğŸ”´)
         completed
        */
    }
    .disposed(by: DisposeBag())
{% endhighlight %}
#### 7.range
åˆ›å»ºå‘é€ä¸€è¿ä¸²æœ‰åºæ•°å­—äº‹ä»¶çš„å¯è®¢é˜…äº‹ä»¶æµã€‚
{% highlight Swift %}
Observable.range(start: 1, count: 5)
    .subscribe {
        print($0)
        /*
         next(1)
         next(2)
         next(3)
         next(4)
         next(5)
         completed
        */
    }
    .disposed(by: DisposeBag())
{% endhighlight %}
#### 8.repeatElement
é‡å¤å‘é€næ¬¡ä¸€ä¸ªç‰¹å®šäº‹ä»¶çš„å¯è®¢é˜…äº‹ä»¶æµã€‚
{% highlight Swift %}
Observable.repeatElement("ğŸ”´")
    .take(3)     // å®šä¹‰é‡å¤å‘é€çš„æ¬¡æ•°
    .subscribe({
        print($0)
        /*
         next(ğŸ”´)
         next(ğŸ”´)
         next(ğŸ”´)
         completed
        */
    })
    .disposed(by: DisposeBag())
{% endhighlight %}
#### 9.generate
å¾ªç¯æ”¹å˜åˆå§‹å€¼ï¼Œåˆ¤æ–­åˆå§‹å€¼åœ¨åˆ¤æ–­æ¡ä»¶çš„ç»“æœæ˜¯å¦ä¸ºtrueæ¥æ§åˆ¶äº‹ä»¶çš„å‘é€ã€‚
{% highlight Swift %}
Observable.generate(
    initialState: 0,
    condition: { $0 < 3 },
    iterate: { $0 + 1 }
    )
    .subscribe({
        print($0)
        /*
         next(0)
         next(1)
         next(2)
         completed
        */
    })
    .disposed(by: DisposeBag())
{% endhighlight %}
### â€¢ Subject
Subjectæ—¢èƒ½ä½œä¸ºå¯è®¢é˜…çš„äº‹ä»¶æµï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè®¢é˜…è€…çš„ã€‚
#### 1.PublishSubject
PublishSubjectä½œä¸ºè®¢é˜…è€…çš„æ—¶å€™åªèƒ½æ¥æ”¶è®¢é˜…ä¹‹åå‘é€çš„äº‹ä»¶ã€‚
{% highlight Swift %}
let disposeBag = DisposeBag()
let subject = PublishSubject<String>()
subject.subscribe({
    print("Subscription:1, Event:",$0);
}).disposed(by: disposeBag)
subject.onNext("ğŸ¶")
subject.onNext("ğŸ±")
subject.subscribe({
    print("Subscription:2, Event:",$0);
}).disposed(by: disposeBag)
subject.onNext("ğŸ…°ï¸")
subject.onNext("ğŸ…±ï¸")
/*
 Subscription:1, Event: next(ğŸ¶)
 Subscription:1, Event: next(ğŸ±)
 Subscription:1, Event: next(ğŸ…°ï¸)
 Subscription:2, Event: next(ğŸ…°ï¸)
 Subscription:1, Event: next(ğŸ…±ï¸)
 Subscription:2, Event: next(ğŸ…±ï¸)
*/
{% endhighlight %}
#### 2.ReplaySubject
ReplaySubjectä½œä¸ºè®¢é˜…è€…çš„æ—¶å€™ï¼Œä¸ä»…æ¥æ”¶è®¢é˜…ä¹‹åå‘é€çš„äº‹ä»¶ï¼Œè¿˜èƒ½è®¾ç½®æ¥æ”¶è®¢é˜…ä¹‹å‰å‘é€çš„nä¸ªäº‹ä»¶ã€‚
{% highlight Swift %}
let disposeBag = DisposeBag()
let subject = ReplaySubject<String>.create(bufferSize: 2)     // æ¥æ”¶è®¢é˜…å‰çš„2ä¸ªäº‹ä»¶
subject.subscribe({
    print("Subscription:1, Event:",$0);
}).disposed(by: disposeBag)
subject.onNext("ğŸ¶")
subject.onNext("ğŸ±")
subject.onNext("ğŸ­")
subject.subscribe({
    print("Subscription:2, Event:",$0);
}).disposed(by: disposeBag)
subject.onNext("ğŸ…°ï¸")
subject.onNext("ğŸ…±ï¸")
/*
 Subscription:1, Event: next(ğŸ¶)
 Subscription:1, Event: next(ğŸ±)
 Subscription:1, Event: next(ğŸ­)
 Subscription:2, Event: next(ğŸ­)
 Subscription:1, Event: next(ğŸ…°ï¸)
 Subscription:2, Event: next(ğŸ…°ï¸)
 Subscription:1, Event: next(ğŸ…±ï¸)
 Subscription:2, Event: next(ğŸ…±ï¸)
*/
{% endhighlight %}
#### 3.BehaviorSubject
BehaviorSubjectä½œä¸ºè®¢é˜…è€…çš„æ—¶å€™ï¼Œä¸ä»…æ¥æ”¶è®¢é˜…ä¹‹åå‘é€çš„äº‹ä»¶ï¼Œè¿˜æ¥æ”¶è®¢é˜…ä¹‹å‰æœ€åå‘é€çš„äº‹ä»¶ã€‚æ•ˆæœç­‰åŒäº <code>ReplaySubject<String>.create(bufferSize: 1) 
{% highlight Swift %}
let disposeBag = DisposeBag()
let subject = BehaviorSubject(value: "ğŸ”´")
subject.subscribe({
    print("Subscription:1, Event:",$0);
}).disposed(by: disposeBag)
subject.onNext("ğŸ¶")
subject.onNext("ğŸ±")
subject.subscribe({
    print("Subscription:2, Event:",$0);
}).disposed(by: disposeBag)
subject.onNext("ğŸ…°ï¸")
subject.onNext("ğŸ…±ï¸")
subject.subscribe({
    print("Subscription:3, Event:",$0);
}).disposed(by: disposeBag)
subject.onNext("ğŸ")
subject.onNext("ğŸŠ")
/*
 Subscription:1, Event: next(ğŸ”´)
 Subscription:1, Event: next(ğŸ¶)
 Subscription:1, Event: next(ğŸ±)
 Subscription:2, Event: next(ğŸ±)
 Subscription:1, Event: next(ğŸ…°ï¸)
 Subscription:2, Event: next(ğŸ…°ï¸)
 Subscription:1, Event: next(ğŸ…±ï¸)
 Subscription:2, Event: next(ğŸ…±ï¸)
 Subscription:3, Event: next(ğŸ…±ï¸)
 Subscription:1, Event: next(ğŸ)
 Subscription:2, Event: next(ğŸ)
 Subscription:3, Event: next(ğŸ)
 Subscription:1, Event: next(ğŸŠ)
 Subscription:2, Event: next(ğŸŠ)
 Subscription:3, Event: next(ğŸŠ)
*/
{% endhighlight %}
#### 4.Variable
Variableä½œä¸ºè®¢é˜…è€…çš„æ—¶å€™ï¼Œä¸ä»…æ¥æ”¶è®¢é˜…ä¹‹åå‘é€çš„äº‹ä»¶ï¼Œè¿˜æ¥æ”¶è®¢é˜…ä¹‹å‰æœ€åå‘é€çš„äº‹ä»¶ã€‚Variableä¸BehaviorSubjectçš„åŒºåˆ«å°±æ˜¯Variableä¼šè‡ªåŠ¨å‘é€completedäº‹ä»¶ã€‚
{% highlight Swift %}
let disposeBag = DisposeBag()
let variable = Variable("ğŸ”´")
subject.subscribe({
    print("Subscription:1, Event:",$0);
}).disposed(by: disposeBag)
variable.value = "ğŸ¶"
variable.value = "ğŸ±"
subject.subscribe({
    print("Subscription:2, Event:",$0);
}).disposed(by: disposeBag)
variable.value = "ğŸ…°ï¸"
variable.value = "ğŸ…±ï¸"
/*
 Subscription:1, Event: next(ğŸ”´)
 Subscription:1, Event: next(ğŸ¶)
 Subscription:1, Event: next(ğŸ±)
 Subscription:2, Event: next(ğŸ±)
 Subscription:1, Event: next(ğŸ…°ï¸)
 Subscription:2, Event: next(ğŸ…°ï¸)
 Subscription:1, Event: next(ğŸ…±ï¸)
 Subscription:2, Event: next(ğŸ…±ï¸)
 Subscription:1, Event: completed
 Subscription:2, Event: completed
*/
{% endhighlight %}

